<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Главная</title>
    <link rel="shortcut icon" href="/img/icon.png" type="image/png">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="/style/main.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="../home">
            Business analyst
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item ">
              <a class="nav-link" href="../home">Главная <span class="sr-only"></span></a>
            </li>
            <li class="nav-item  ">
                    <a class="nav-link" href="/analyst">Анализ продаж <span class="sr-only"></span></a>
            </li>
            <li class="nav-item active">
                    <a class="nav-link" href="/blog">Блог <span class="sr-only"></span></a>
                </li>                
            <li class="nav-item ">
                <a class="nav-link" href="/target">Анализ ЦА <span class="sr-only"></span></a>
            </li>
            <li class="nav-item ">
                    <a class="nav-link" href="/add_db">Добавить новость <span class="sr-only"></span></a>
            </li>
           
            
          </ul>
          <span class="navbar-text">
                <a href="../logout" class="navber_a">Выход</a>
                <!-- <a href="../register" class="navber_a">Регистрация</a> -->
         </span>
        </div>
      </nav>
      
      <!-- <br>
      <br>
      <br> -->
      <!-- <a href="" class="blog_news_text_ul_hide_show" data-b="false" data-id="1"  >Так</a> -->
      <div class="container">
            <div class="row">
              <div class="col-md-12">
                    <p class="business_blog">Полезный бизнес блог</p>
                    
                    <div class="blog"  >
                           

                    </div>
                    <!-- теги -->
                   
                          
               </div>
      </div>   
    </div>
<!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script> -->
<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="../js/blog.js"></script>
<script>
     $( document ).ready(function() {
         
                let resault={};
                let request = new XMLHttpRequest();
               
                 request.open("POST", "/blog", true);   
                 request.setRequestHeader("Content-Type", "application/json");
                 request.addEventListener("load", function () {
                     resault=JSON.parse(request.response);
                     console.log(resault);
                      blog_fill(resault);
                        });
                 request.send();
                

                 function blog_fill(resault){
                 for (iter in resault) {
                    
                    //     // $('.desc_nextMatch').text(resault[iter].text);
                     $('.blog').append('<div class="alert alert-secondary alert_blog" role="alert"><p class="tag_blog">'+resault[iter].tag+'</p><p class="blog_news_header">'+resault[iter].title+' <img src="../img/star-'+resault[iter].marker+'.png"  class="svg_star" id="img'+iter+'" data-id="'+iter+'" data-bol="'+resault[iter].marker+'" data-key='+resault[iter].key +'></p><p class="blog_news_text">'+resault[iter].desc_title+'<br><ul class="blog_news_text_ul">'+resault[iter].pre+'<a href="" class="blog_news_text_ul_hide_show camon" data-b="false" data-id="'+iter+'" >развернуть ▼</a><span class="blog_news_text_ul_full_text" id="'+iter+'">'+resault[iter].post+'</span></ul></p>');
        
                    }
                 }
});
$(document).on('click', '.svg_star', function (e) {
    
    let data1=$(this).attr('data-key');
    let bol =  $(this).attr('data-bol');
    if (bol == 'false'){
        $(this).attr("src", '../img/star-true.png');
        $(this).attr("data-bol", 'true');
        let id =   $(this).attr("data-id");
        console.log(id);
        // let res={};
        // let req = new XMLHttpRequest();
               
        // req.open("POST", "/blog_star", true);   
        // req.setRequestHeader("Content-Type", "application/json");
        // $.ajax({
        //         type: "POST",
        //         url: "/blog_star",
        //         data: "name=John&location=Boston",
        //         success: function(msg){
        //             alert( "Прибыли данные: " + msg );
        //     } 
        //     });
    //     var ajaxSettings = {
    //             method: 'POST',
    //             url: '/blog_star',
    //             data: data1,
    //             //					dataType: form.method === 'get' ? 'jsonp' : 'json',
    //             dataType: 'json',
    //             contentType: 'application/json',
    //             processData: false,
    //             xhrFields: {
    //                 withCredentials: true
    //             }
    //             };
    // var ajaxRequest = $.ajax(ajaxSettings);
    $.ajax({
      url: '/blog_star', // путь к php-обработчику
      type: 'POST', // метод передачи данных
      dataType: 'json', // тип ожидаемых данных в ответе
      data: {key: data1}, // данные, которые передаем на сервер
    //   beforeSend: function(){ // Функция вызывается перед отправкой запроса
    //     output.text('Запрос отправлен. Ждите ответа.');
    //   },
    //   error: function(req, text, error){ // отслеживание ошибок во время выполнения ajax-запроса
    //     output.text('Хьюстон, У нас проблемы! ' + text + ' | ' + error);
    //   },
    //   complete: function(){ // функция вызывается по окончании запроса
    //     output.append('<p>Запрос полностью завершен!</p>');
    //   },
    //   success: function(json){ // функция, которая будет вызвана в случае удачного завершения запроса к серверу
    //     // json - переменная, содержащая данные ответа от сервера. Обзывайте её как угодно ;)
    //     output.html(json); // выводим на страницу данные, полученные с сервера
    //   }
    });
    }
    else {

    }
  
});

</script>

</body>
</html>
